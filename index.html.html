<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>×”×–×× ×ª ×× ×•×ª - ××™×¡×•×¨×“</title>
    <style>
        * { box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background: #f0f4f8; padding: 15px; margin: 0; }
        
        .logo { background: #1F4E79; padding: 20px; text-align: center; border-radius: 8px; margin-bottom: 15px; }
        .logo-main { font-size: 42px; font-weight: bold; color: white; letter-spacing: 5px; }
        .logo-sub { font-size: 14px; color: #8BC34A; margin-top: 5px; }
        
        .contact { background: #2E75B6; color: white; padding: 12px; text-align: center; border-radius: 8px; margin-bottom: 15px; font-size: 14px; }
        .contact a { color: white; }
        
        .card { background: white; padding: 20px; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .card-title { color: #1F4E79; font-weight: bold; font-size: 16px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #1F4E79; }
        
        .field { margin-bottom: 15px; }
        .field label { display: block; font-weight: bold; margin-bottom: 6px; font-size: 14px; }
        .field input, .field select, .field textarea {
            width: 100%; padding: 12px; font-size: 16px;
            border: 2px solid #ddd; border-radius: 6px; background: #FFFFD0;
        }
        .field textarea { height: 60px; resize: none; }
        .field select { height: 48px; }
        
        .btn-row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px; }
        .btn {
            flex: 1; min-width: 120px; padding: 15px; font-size: 16px; font-weight: bold;
            border: none; border-radius: 8px; color: white;
        }
        .btn-green { background: #70AD47; }
        .btn-red { background: #C00000; }
        .btn-blue { background: #1F4E79; }
        .btn-dark-green { background: #217346; }
        
        .order-box { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .order-header { background: #1F4E79; color: white; padding: 15px; text-align: center; border-radius: 8px 8px 0 0; margin: -15px -15px 15px -15px; }
        .order-header-title { font-size: 24px; font-weight: bold; letter-spacing: 3px; }
        .order-header-sub { font-size: 11px; color: #8BC34A; }
        
        .order-info { background: #D9E2F3; padding: 12px; border-radius: 6px; margin-bottom: 15px; font-size: 13px; line-height: 1.8; }
        
        .product-box { margin-bottom: 20px; }
        .product-title { background: #1F4E79; color: white; padding: 10px; font-weight: bold; border-radius: 6px 6px 0 0; }
        
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { background: #D9E2F3; padding: 8px 4px; border: 1px solid #999; font-size: 12px; }
        td { padding: 8px 4px; border: 1px solid #999; text-align: center; }
        .total-row { background: #FFF3CD; font-weight: bold; }
        
        .empty-msg { text-align: center; color: #888; padding: 30px; }
        
        @media print {
            .card, .contact { display: none; }
            body { padding: 5px; }
        }
    </style>
</head>
<body>

<div class="logo">
    <div class="logo-main">ISORAD</div>
    <div class="logo-sub">Radiopharmacy</div>
</div>

<div class="contact">
    ğŸ“ <a href="tel:089434424">08-9434424</a> | âœ‰ï¸ <a href="mailto:radiopharmacy@isorad.co.il">radiopharmacy@isorad.co.il</a>
</div>

<div class="card">
    <div class="card-title">×¤×¨×˜×™ ×”×–×× ×”</div>
    
    <div class="field">
        <label>×©× ×”××•×¡×“:</label>
        <select id="sel_inst">
            <option value="">-- ×‘×—×¨ ××•×¡×“ --</option>
            <option>××¨×›×– ×¨×¤×•××™ ×”×“×¡×” ×¢×™×Ÿ-×›×¨× ×¨×¤×•××” ×’×¨×¢×™× ×™×ª</option>
            <option>×.×.×¨ ×™×¨×•×©×œ×™×</option>
            <option>××¨×›×– ×¨×¤×•××™ ×©×¢×¨×™ ×¦×“×§</option>
            <option>×¡×¤×§×˜×¨×•× ×”×“××™×”</option>
            <option>××¨×›×– ×¨×¤×•××™ ××¡×£ ×”×¨×•×¤×</option>
            <option>×”××¨×›×– ×¨×¤×•××™ ×¢×´×© ×—×™×™× ×©×™×‘× ×¨×¤×•××” ×’×¨×¢×™× ×™×ª</option>
            <option>×”××¨×›×– ×”×¨×¤×•××™ ×¢×´×© ×—×™×™× ×©×™×‘× ×§×¨×Ÿ ××—×§×¨×™×</option>
            <option>××¨×›×– ×¨×¤×•××™ ×•×•×œ×¤×¡×•×Ÿ</option>
            <option>×”××¨×›×– ×”×¨×¤×•××™ ×¢×´×© ×—×™×™× ×©×™×‘× ××›×•×Ÿ ×”×œ×‘</option>
            <option>×©×¨×•×ª×™ ×‘×¨×™××•×ª ×›×œ×œ×™×ª ××¨×›×– ×©× ×™×™×“×¨ ×œ×¨×¤×•××ª ×™×œ×“×™×</option>
            <option>×©×¨×•×ª×™ ×‘×¨×™××•×ª ×›×œ×œ×™×ª ×‘×™×´×— ×‘×™×œ×™× ×¡×•×Ÿ ×¨×¤×•××” ×’×¨×¢×™× ×™×ª</option>
            <option>×©×¨×•×ª×™ ×‘×¨×™××•×ª ×›×œ×œ×™×ª ×‘×™×´×— ×‘×™×œ×™× ×¡×•×Ÿ ×§×¨×“×™×•×œ×•×’×™×”</option>
            <option>×©×¨×•×ª×™ ×‘×¨×™××•×ª ×›×œ×œ×™×ª ×‘×™×ª ×—×•×œ×™× ×”×©×¨×•×Ÿ</option>
            <option>××¨×›×– ×¨×¤×•××™ ×ª×´× ×¢×´×© ×¡×•×¨×¡×§×™ ××™×›×™×œ×•×‘ ×¨×¤×•××” ×’×¨×¢×™× ×™×ª</option>
            <option>××¡×•×ª× ××¨×›×–×™× ×¨×¤×•××™×™× ×¡× ×™×£ ×¨××©×œ×´×¦</option>
            <option>××¡×•×ª× ××¨×›×–×™× ×¨×¤×•××™×™× ×¡× ×™×£ ×¨××ª ×”×—×™×™×œ</option>
            <option>××¡×•×ª× ××¨×›×–×™× ×¨×¤×•××™×™× ×¡× ×™×£ ××›×•×Ÿ ×”×œ×‘</option>
            <option>× ×•×¨ ××“</option>
            <option>×§×¨ ×©×¨×•×ª×™ ×¨×¤×•××” ×‘×¢×´× ×¡× ×™×£ × ×ª× ×™×”</option>
            <option>××¡×•×ª× ××¨×›×–×™× ×¨×¤×•××™×™× ×¡× ×™×£ ××©×“×•×“</option>
            <option>××¡×•×ª× ××¨×›×–×™× ×¨×¤×•××™×™× ××›×•×Ÿ PET</option>
            <option>××¡×•×ª× ××¨×›×–×™× ×¨×¤×•××™×™× ×‘×™×ª ××¨×§×—×ª</option>
            <option>××¡×•×ª× ××¨×›×–×™× ×¨×¤×•××™×™× ×¡× ×™×£ ×—×™×¤×”</option>
            <option>×¢××•×ª×ª ×‘×™×ª ×—×•×œ×™× ×”×¦×™×‘×•×¨×™ ××¡×•×ª× ××©×“×•×“</option>
            <option>××¡×•×ª× ××¨×›×–×™× ×¨×¤×•××™×™× ×¡× ×™×£ ×‘××¨ ×©×‘×¢</option>
            <option>××¨×›×– ×¨×¤×•××™ ×¨××‘×´×</option>
            <option>×ª××’×™×“ ×”×‘×¨×™××•×ª ×¨××‘×´×</option>
            <option>×”××¨×›×– ×œ××—×§×¨ ×’×¨×¢×™× ×™</option>
            <option>×”××¨×›×– ×”×¨×¤×•××™ ×–×™×•</option>
            <option>×”××¨×›×– ×”×¨×¤×•××™ ×”×œ×œ ×™×¤×”</option>
            <option>×‘×™×ª ×—×•×œ×™× × ×”×¨×™×”</option>
            <option>×©×¨×•×ª×™ ×‘×¨×™××•×ª ×›×œ×œ×™×ª ××¨×›×– ×¨×¤×•××™ ×›×¨××œ</option>
            <option>×©×¨×•×ª×™ ×‘×¨×™××•×ª ×›×œ×œ×™×ª ××¨×›×– ×¨×¤×•××™ ×××™×¨</option>
            <option>×©×¨×•×ª×™ ×‘×¨×™××•×ª ×›×œ×œ×™×ª ××¨×›×– ×¨×¤×•××™ ×”×¢××§</option>
            <option>××¨×›×– ×¨×¤×•××™ ×‘× ×™ ×¦×™×•×Ÿ ×§×¨×Ÿ ××—×§×¨×™×</option>
            <option>GE MEDICAL SYSTEM ISRAEL LTD</option>
            <option>×.×.×¨ × ×¦×¨×ª</option>
            <option>×‘×™×ª ×—×•×œ×™× ×‘×¨×–×™×œ×™ ×§×¨×Ÿ ××—×§×¨×™×</option>
            <option>×‘×™×ª ×—×•×œ×™× ×‘×¨×–×™×œ×™</option>
            <option>×©×¨×•×ª×™ ×‘×¨×™××•×ª ×›×œ×œ×™×ª ××¨×›×– ×¨×¤×•××™ ×§×¤×œ×Ÿ ××™×–×•×˜×•×¤×™×</option>
            <option>×©×¨×•×ª×™ ×‘×¨×™××•×ª ×›×œ×œ×™×ª ××¨×›×– ×¨×¤×•××™ ×§×¤×œ×Ÿ ×§×¨×“×™×•×œ×•×’×™×”</option>
            <option>×©×¨×•×ª×™ ×‘×¨×™××•×ª ×›×œ×œ×™×ª ××¨×›×– ×¨×¤×•××™ ×¡×•×¨×•×§×”</option>
            <option>×.×.×¨ ×‘××¨ ×©×‘×¢</option>
            <option>×.×.×¨ ×§×¨×™×ª ×’×ª</option>
            <option>×‘×™×ª ×—×•×œ×™× ××’×•×¡×˜×” ×•×™×§×˜×•×¨×™×”</option>
            <option>Aleena Nuclear Imaging</option>
            <option>×‘×™×ª ×”×—×•×œ×™× ×”××©×¤×—×” ×”×§×“×•×©×”</option>
            <option>××¨×›×– ×¨×¤×•××™ ×‘× ×™ ×¦×™×•×Ÿ</option>
            <option>Istishari Cancer Center</option>
            <option>AL-Ahli Hospital</option>
        </select>
    </div>
    
    <div class="field">
        <label>×ª××¨×™×š ×”×–×× ×”:</label>
        <input type="date" id="inp_date">
    </div>
    
    <div class="field">
        <label>×©× ××‘×¦×¢ ×”×”×–×× ×”:</label>
        <input type="text" id="inp_name" placeholder="×”×–×Ÿ ×©×">
    </div>
</div>

<div class="card">
    <div class="card-title">×¤×¨×˜×™ ×ª×›×©×™×¨</div>
    
    <div class="field">
        <label>×‘×—×¨ ×ª×›×©×™×¨:</label>
        <select id="sel_prod">
            <option value="">-- ×‘×—×¨ ×ª×›×©×™×¨ --</option>
            <option>MDP</option>
            <option>DMSA</option>
            <option>S.C</option>
            <option>Sestamibi Stress</option>
            <option>Sestamibi Rest</option>
            <option>Sestamibi Parathyroid</option>
            <option>Ga-67</option>
            <option>Tl-201</option>
            <option>MAG-3</option>
            <option>DTPA</option>
            <option>Filter S.C</option>
            <option>MAA</option>
            <option>FDG</option>
            <option>Ga-68 Dota Tate</option>
            <option>Ga-68 PSMA</option>
            <option>FPSMA</option>
        </select>
    </div>
    
    <div class="field">
        <label>×©×¢×ª ×›×™×•×œ ×”×× ×” ×”×¨××©×•× ×”:</label>
        <input type="time" id="inp_time" value="08:00">
    </div>
    
    <div class="field">
        <label>××¡×¤×¨ ×× ×•×ª:</label>
        <input type="number" id="inp_num" value="5" min="1" max="50">
    </div>
    
    <div class="field">
        <label>××§×˜×™×‘×™×•×ª (mCi):</label>
        <input type="number" id="inp_act" value="25" min="0.1" max="100" step="0.1">
    </div>
    
    <div class="field">
        <label>××¨×•×•×— ×–××Ÿ (×“×§×•×ª):</label>
        <input type="number" id="inp_int" value="30" min="5" max="120">
    </div>
    
    <div class="field">
        <label>×”×¢×¨×”:</label>
        <textarea id="inp_note" placeholder="×”×¢×¨×” ×œ×× ×•×ª ××œ×• (××•×¤×¦×™×•× ×œ×™)"></textarea>
    </div>
    
    <div class="btn-row">
        <button type="button" class="btn btn-green" onclick="doAdd()">â• ×”×•×¡×£ ×œ×”×–×× ×”</button>
    </div>
    <div class="btn-row">
        <button type="button" class="btn btn-red" onclick="doClear()">ğŸ—‘ï¸ × ×§×”</button>
        <button type="button" class="btn btn-blue" onclick="doPrint()">ğŸ–¨ï¸ ×”×“×¤×¡</button>
    </div>
    <div class="btn-row">
        <button type="button" class="btn btn-dark-green" onclick="doExport()">ğŸ“Š ×™×™×¦× ×œ-Excel</button>
    </div>
</div>

<div class="order-box">
    <div class="order-header">
        <div class="order-header-title">ISORAD</div>
        <div class="order-header-sub">Radiopharmacy</div>
    </div>
    
    <div class="order-info">
        <div><strong>××•×¡×“:</strong> <span id="out_inst">---</span></div>
        <div><strong>×ª××¨×™×š:</strong> <span id="out_date">---</span> | <strong>××–××™×Ÿ:</strong> <span id="out_name">---</span> | <strong>×©×¢×ª ×”×¤×§×”:</strong> <span id="out_time">---</span></div>
    </div>
    
    <div id="out_tables">
        <div class="empty-msg">×œ× × ×•×¡×¤×• ×ª×›×©×™×¨×™× ×œ×”×–×× ×”</div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.4.0/exceljs.min.js"></script>

<script>
var DATA = {};

window.onload = function() {
    var d = new Date();
    d.setDate(d.getDate() + 1);
    var y = d.getFullYear();
    var m = d.getMonth() + 1;
    var day = d.getDate();
    if (m < 10) m = '0' + m;
    if (day < 10) day = '0' + day;
    document.getElementById('inp_date').value = y + '-' + m + '-' + day;
};

function getTime() {
    var d = new Date();
    var h = d.getHours();
    var m = d.getMinutes();
    if (h < 10) h = '0' + h;
    if (m < 10) m = '0' + m;
    return h + ':' + m;
}

function pad(n) {
    return n < 10 ? '0' + n : '' + n;
}

function fmtDate(s) {
    if (!s) return '---';
    var p = s.split('-');
    return p[2] + '/' + p[1] + '/' + p[0];
}

function doAdd() {
    var inst = document.getElementById('sel_inst').value;
    var dt = document.getElementById('inp_date').value;
    var nm = document.getElementById('inp_name').value;
    var prod = document.getElementById('sel_prod').value;
    var tm = document.getElementById('inp_time').value;
    var num = parseInt(document.getElementById('inp_num').value) || 5;
    var act = parseFloat(document.getElementById('inp_act').value) || 25;
    var intv = parseInt(document.getElementById('inp_int').value) || 30;
    var note = document.getElementById('inp_note').value;
    
    if (!prod) {
        alert('× × ×œ×‘×—×•×¨ ×ª×›×©×™×¨');
        return;
    }
    if (!inst) {
        alert('× × ×œ×‘×—×•×¨ ××•×¡×“');
        return;
    }
    
    document.getElementById('out_inst').innerText = inst;
    document.getElementById('out_date').innerText = fmtDate(dt);
    document.getElementById('out_name').innerText = nm || '---';
    
    var tp = tm.split(':');
    var hrs = parseInt(tp[0]) || 8;
    var mins = parseInt(tp[1]) || 0;
    var total = hrs * 60 + mins;
    
    if (!DATA[prod]) {
        DATA[prod] = [];
    }
    
    for (var i = 0; i < num; i++) {
        var h = Math.floor(total / 60);
        var m = total % 60;
        DATA[prod].push({
            t: pad(h) + ':' + pad(m),
            a: act,
            n: note
        });
        total = total + intv;
    }
    
    render();
    document.getElementById('sel_prod').value = '';
    document.getElementById('inp_note').value = '';
}

function render() {
    var box = document.getElementById('out_tables');
    var keys = [];
    for (var k in DATA) {
        keys.push(k);
    }
    
    if (keys.length === 0) {
        box.innerHTML = '<div class="empty-msg">×œ× × ×•×¡×¤×• ×ª×›×©×™×¨×™× ×œ×”×–×× ×”</div>';
        return;
    }
    
    var html = '';
    for (var i = 0; i < keys.length; i++) {
        var prod = keys[i];
        var arr = DATA[prod];
        var cnt = arr.length;
        
        html += '<div class="product-box">';
        html += '<div class="product-title">' + prod + '</div>';
        html += '<table>';
        html += '<tr><th>×©×¢×”</th><th>mCi</th><th>×›××•×ª</th><th>×”×¢×¨×•×ª</th></tr>';
        
        for (var j = 0; j < arr.length; j++) {
            var row = arr[j];
            html += '<tr>';
            html += '<td>' + row.t + '</td>';
            html += '<td>' + row.a + '</td>';
            html += '<td>1</td>';
            html += '<td style="text-align:right;font-size:11px;">' + (row.n || '') + '</td>';
            html += '</tr>';
        }
        
        html += '<tr class="total-row">';
        html += '<td colspan="2" style="text-align:right;">×¡×”×´×›:</td>';
        html += '<td>' + cnt + '</td>';
        html += '<td></td>';
        html += '</tr>';
        
        html += '</table></div>';
    }
    
    box.innerHTML = html;
}

function doClear() {
    if (confirm('×œ× ×§×•×ª ××ª ×”×”×–×× ×”?')) {
        DATA = {};
        document.getElementById('out_inst').innerText = '---';
        document.getElementById('out_date').innerText = '---';
        document.getElementById('out_name').innerText = '---';
        document.getElementById('out_time').innerText = '---';
        render();
    }
}

function doPrint() {
    var keys = [];
    for (var k in DATA) keys.push(k);
    if (keys.length === 0) {
        alert('××™×Ÿ × ×ª×•× ×™×');
        return;
    }
    document.getElementById('out_time').innerText = getTime();
    window.print();
}

function doExport() {
    var keys = [];
    for (var k in DATA) keys.push(k);
    if (keys.length === 0) {
        alert('××™×Ÿ × ×ª×•× ×™×');
        return;
    }
    
    var inst = document.getElementById('out_inst').innerText;
    var dt = document.getElementById('out_date').innerText;
    var nm = document.getElementById('out_name').innerText;
    var tm = getTime();
    document.getElementById('out_time').innerText = tm;
    
    var wb = new ExcelJS.Workbook();
    var ws = wb.addWorksheet('×”×–×× ×”', {views: [{rightToLeft: true}]});
    
    ws.columns = [{width:18}, {width:20}, {width:12}, {width:50}];
    
    ws.mergeCells('A1:D1');
    ws.getCell('A1').value = 'ISORAD - Radiopharmacy';
    ws.getCell('A1').font = {bold:true, size:20, color:{argb:'FFFFFFFF'}};
    ws.getCell('A1').fill = {type:'pattern', pattern:'solid', fgColor:{argb:'FF1F4E79'}};
    ws.getCell('A1').alignment = {horizontal:'center'};
    ws.getRow(1).height = 32;
    
    ws.mergeCells('A2:D2');
    ws.getCell('A2').value = '××•×¡×“: ' + inst + ' | ×ª××¨×™×š: ' + dt + ' | ××–××™×Ÿ: ' + nm + ' | ×©×¢×”: ' + tm;
    ws.getCell('A2').fill = {type:'pattern', pattern:'solid', fgColor:{argb:'FFD9E2F3'}};
    ws.getCell('A2').alignment = {horizontal:'center'};
    
    var row = 4;
    for (var i = 0; i < keys.length; i++) {
        var prod = keys[i];
        var arr = DATA[prod];
        
        ws.mergeCells('A'+row+':D'+row);
        ws.getCell('A'+row).value = prod;
        ws.getCell('A'+row).font = {bold:true, size:14, color:{argb:'FFFFFFFF'}};
        ws.getCell('A'+row).fill = {type:'pattern', pattern:'solid', fgColor:{argb:'FF1F4E79'}};
        ws.getCell('A'+row).alignment = {horizontal:'center'};
        row++;
        
        var hdr = ['×©×¢×ª ×›×™×•×œ', '××§×˜×™×‘×™×•×ª', '×›××•×ª', '×”×¢×¨×•×ª'];
        for (var h = 0; h < 4; h++) {
            ws.getCell(row, h+1).value = hdr[h];
            ws.getCell(row, h+1).font = {bold:true};
            ws.getCell(row, h+1).fill = {type:'pattern', pattern:'solid', fgColor:{argb:'FFD9E2F3'}};
            ws.getCell(row, h+1).border = {top:{style:'thin'}, left:{style:'thin'}, bottom:{style:'thin'}, right:{style:'thin'}};
        }
        row++;
        
        for (var j = 0; j < arr.length; j++) {
            ws.getCell(row, 1).value = arr[j].t;
            ws.getCell(row, 2).value = arr[j].a;
            ws.getCell(row, 3).value = 1;
            ws.getCell(row, 4).value = arr[j].n || '';
            for (var c = 1; c <= 4; c++) {
                ws.getCell(row, c).border = {top:{style:'thin'}, left:{style:'thin'}, bottom:{style:'thin'}, right:{style:'thin'}};
            }
            row++;
        }
        
        ws.mergeCells('A'+row+':B'+row);
        ws.getCell('A'+row).value = '×¡×”×´×›:';
        ws.getCell('A'+row).font = {bold:true};
        ws.getCell('A'+row).fill = {type:'pattern', pattern:'solid', fgColor:{argb:'FFFFF3CD'}};
        ws.getCell('A'+row).alignment = {horizontal:'right'};
        ws.getCell(row, 3).value = arr.length;
        ws.getCell(row, 3).font = {bold:true};
        ws.getCell(row, 3).fill = {type:'pattern', pattern:'solid', fgColor:{argb:'FFFFF3CD'}};
        row += 2;
    }
    
    wb.xlsx.writeBuffer().then(function(buf) {
        var blob = new Blob([buf], {type:'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'});
        var url = URL.createObjectURL(blob);
        var a = document.createElement('a');
        a.href = url;
        a.download = '×”×–×× ×”.xlsx';
        a.click();
    });
}
</script>

</body>
</html>
